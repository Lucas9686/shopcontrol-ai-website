---
phase: 06-og-image-performance
plan: 02
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - webapp/next.config.mjs
  - webapp/components/hero.tsx
  - webapp/components/smooth-scroll.tsx
  - webapp/public/images/diagrams/support-agent-ablauf.png
  - webapp/public/images/workflows/gesamter-workflow.png
autonomous: false

must_haves:
  truths:
    - "Lighthouse mobile performance score is 90+ on homepage"
    - "No render-blocking resources flagged by Lighthouse"
    - "No unoptimized images flagged by Lighthouse"
  artifacts:
    - path: "webapp/next.config.mjs"
      provides: "Image optimization enabled"
      contains: "images"
    - path: "webapp/components/hero.tsx"
      provides: "Optimized hero images using next/image"
  key_links:
    - from: "webapp/next.config.mjs"
      to: "next/image component"
      via: "images config enabling sharp optimization"
      pattern: "images"
---

<objective>
Optimize website performance to achieve Lighthouse mobile score 90+ on homepage.

Purpose: Professional websites need fast load times. Lighthouse 90+ demonstrates technical competence to the jury.
Output: Optimized Next.js config, converted images, and performant components.
</objective>

<execution_context>
@C:\Users\Lucas Benutzer\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Lucas Benutzer\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-og-image-performance/06-RESEARCH.md
@.planning/phases/06-og-image-performance/06-01-SUMMARY.md
@webapp/next.config.mjs
@webapp/components/hero.tsx
@webapp/components/smooth-scroll.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Enable Next.js image optimization and compress large images</name>
  <files>
    webapp/next.config.mjs
    webapp/public/images/diagrams/support-agent-ablauf.png
    webapp/public/images/workflows/gesamter-workflow.png
  </files>
  <action>
1. In `webapp/next.config.mjs`, remove `images: { unoptimized: true }` to enable Next.js automatic image optimization via sharp (already installed). Keep any other image config that may be needed (remotePatterns, etc.).

2. Compress the two largest images using sharp:
   - `webapp/public/images/diagrams/support-agent-ablauf.png` (1.28MB) — resize to max 1200px width, convert to WebP, quality 80. Save as `.webp` alongside or replace. If replacing, update all component references from `.png` to `.webp`.
   - `webapp/public/images/workflows/gesamter-workflow.png` (670KB) — same treatment.

3. Check for any `<img>` tags in components (especially hero.tsx). Convert raw `<img>` tags to `next/image` (`Image` component) with proper `width`, `height`, and `alt` attributes. This enables lazy loading and automatic WebP serving.

4. Delete unused professional-headshot-*.png files from public/ if they exist and are not referenced anywhere (research says unused). Verify with grep first.

5. Run `npm run build` in webapp/ to verify everything compiles.
  </action>
  <verify>
- `webapp/next.config.mjs` does NOT contain `unoptimized: true`
- Large images are compressed (< 200KB each)
- No raw `<img>` tags for local images (use `next/image` instead)
- `npm run build` passes
  </verify>
  <done>Image optimization enabled, large images compressed, hero uses next/image. Build passes.</done>
</task>

<task type="auto">
  <name>Task 2: Audit smooth-scroll and fix remaining Lighthouse issues</name>
  <files>
    webapp/components/smooth-scroll.tsx
  </files>
  <action>
1. Review `webapp/components/smooth-scroll.tsx` for the continuous requestAnimationFrame (RAF) loop from Lenis. If Lenis runs a permanent RAF loop even when no scrolling occurs, consider:
   - Adding cleanup on unmount
   - Using `autoRaf: true` option if available (Lenis handles its own RAF lifecycle)
   - Or wrapping in intersection observer to only run when visible

2. Check for any render-blocking CSS or JS. In Next.js 14+, CSS modules and Tailwind are generally inlined. Verify no external stylesheets are loaded synchronously via `<link>` in layout.tsx or custom document.

3. Verify font loading strategy — Next.js `next/font` handles font optimization automatically. Ensure fonts are loaded via `next/font/google` or `next/font/local`, not via external `<link>` tags.

4. Run `npm run build` to confirm no regressions.
  </action>
  <verify>
- Smooth scroll component has proper cleanup
- No render-blocking external resources in HTML head
- Fonts loaded via next/font (not external links)
- `npm run build` passes
  </verify>
  <done>Smooth scroll optimized, no render-blocking resources, fonts properly loaded.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Performance optimization: enabled Next.js image optimization, compressed large images, converted to next/image, optimized smooth scroll.</what-built>
  <how-to-verify>
1. Run `npm run dev` in webapp/
2. Open http://localhost:3000/de in Chrome
3. Open DevTools > Lighthouse > Performance (Mobile)
4. Run audit — score should be 90+
5. Check that images load properly on all pages (especially Technology page diagrams)
6. Check that smooth scrolling still works
7. Share a page URL in a messaging app — preview should show branded ShopControl AI image
  </how-to-verify>
  <resume-signal>Type "approved" if Lighthouse 90+ and everything works, or describe issues.</resume-signal>
</task>

</tasks>

<verification>
- Lighthouse mobile performance >= 90 on homepage
- All images load correctly across all pages
- Smooth scrolling works without jank
- OG preview image shows correctly when sharing URLs
- `npm run build` passes
</verification>

<success_criteria>
- Lighthouse mobile score 90+ on homepage
- No render-blocking resources flagged
- No unoptimized images flagged
- All pages render correctly with optimized assets
</success_criteria>

<output>
After completion, create `.planning/phases/06-og-image-performance/06-02-SUMMARY.md`
</output>
